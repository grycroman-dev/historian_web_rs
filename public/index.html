<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>RCMS RCOM / Prohlížeč auditních záznamů</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="vendors/datatables/datatables.min.css" />
  <link rel="stylesheet" href="vendors/fontawesome/css/all.min.css" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header>
    <div class="logo-container">
      <img src="logo-light.png" alt="Logo" id="logo" />
      <h1>RCMS RCOM / AuditLog</h1>
    </div>

    <div class="theme-switch">
      <i class="fas fa-sun" aria-hidden="true"></i>
      <label class="switch" aria-label="Přepnout téma">
        <input type="checkbox" id="themeToggle" />
        <span class="slider"></span>
      </label>
      <i class="fas fa-moon" aria-hidden="true"></i>
    </div>
  </header>

  <div id="controls-container">
    <div class="controls-header" id="controlsHeader">
      <span class="title-label"><i class="fas fa-filter"></i> Filtrace a nastavení</span>
      <i class="fas fa-chevron-down toggle-icon" id="controlsToggleIcon"></i>
    </div>
    <div id="controlsContent" class="controls-content">
      <div class="filters-row">
        <!-- Saved Filters & Actions -->
        <div class="saved-filters-group" style="display: flex; align-items: center; gap: 5px; flex-wrap: wrap;">
          <i class="fas fa-clock" title="Uložené filtry a čas"></i>
          <select id="savedFiltersSelect" class="form-select" style="min-width: 200px;">
            <option value="">-- Filtry a čas --</option>
          </select>
          <button id="btnSaveFilter" class="btn-icon" title="Uložit filtr"><i class="fas fa-save"></i></button>
          <button id="btnRenameFilter" class="btn-icon" title="Přejmenovat"><i class="fas fa-edit"></i></button>
          <button id="btnDeleteFilter" class="btn-icon" title="Smazat"><i class="fas fa-trash"></i></button>
        </div>

        <!-- Multiselects -->
        <div class="multiselect-group" style="display: flex; gap: 5px; flex-wrap: wrap;">
          <div class="multiselect">
            <button id="regionBtn" class="dropdown-btn"><i class="fas fa-globe-europe"></i> Region: Vše</button>
            <div id="regionList" class="multiselect-dropdown"></div>
          </div>
          <div class="multiselect">
            <button id="deviceBtn" class="dropdown-btn"><i class="fas fa-server"></i> Zařízení: Vše</button>
            <div id="deviceList" class="multiselect-dropdown"></div>
          </div>
          <div class="multiselect">
            <button id="localityBtn" class="dropdown-btn"><i class="fas fa-map-marker-alt"></i> Lokalita: Vše</button>
            <div id="localityList" class="multiselect-dropdown"></div>
          </div>
          <div class="multiselect">
            <button id="frequencyBtn" class="dropdown-btn"><i class="fas fa-wave-square"></i> Frekvence: Vše</button>
            <div id="frequencyList" class="multiselect-dropdown"></div>
          </div>
          <div class="multiselect">
            <button id="typeBtn" class="dropdown-btn"><i class="fas fa-cube"></i> Typ: Vše</button>
            <div id="typeList" class="multiselect-dropdown"></div>
          </div>
          <div class="multiselect">
            <button id="propertyBtn" class="dropdown-btn"><i class="fas fa-tag"></i> Vlastnost: Vše</button>
            <div id="propertyList" class="multiselect-dropdown"></div>
          </div>
        </div>
      </div>

      <!-- Date Inputs (manual) -->
      <div class="filters-row"
        style="margin-top: 10px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
        <div class="date-group" style="display: flex; gap: 5px; align-items: center; flex-wrap: wrap;">
          <i class="fas fa-calendar-alt"></i>
          <input type="date" id="dateFrom" class="form-input">
          <input type="time" id="timeFrom" class="form-input" step="0.001">
          <span>-</span>
          <input type="date" id="dateTo" class="form-input">
          <input type="time" id="timeTo" class="form-input" step="0.001">
        </div>
      </div>

      <div class="filters-row actions-row"
        style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
        <div class="search-box-wrapper" style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
          <div class="search-box">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="globalSearch" placeholder="Hledat..." class="form-input">
            <button id="clearSearch" class="btn-icon-clear" title="Vymazat hledání" style="display:none;"><i
                class="fas fa-times"></i></button>
          </div>
          <button id="btnResetAll" class="btn-clear" title="Zrušit všechny filtry (Alt+C)">
            <i class="fas fa-undo"></i> Zrušit filtry
          </button>
        </div>

        <div class="right-controls" style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
          <div class="auto-refresh" title="Auto-refresh (30s)">
            <i id="autoRefreshIcon" class="fas fa-sync"></i>
            <span class="small ms-1">VYP</span>
            <label class="switch mx-1">
              <input type="checkbox" id="autoRefreshToggle">
              <span class="slider round"></span>
            </label>
            <span class="small">AUTO</span>
          </div>

          <div class="datasource-control" title="Přepnout zdroj dat (Alt+S)">
            <i id="dbIconSwitch" class="fas fa-database"></i>
            <span class="small ms-1">MAIN</span>
            <label class="switch mx-1">
              <input type="checkbox" id="datasourceToggle">
              <span class="slider round"></span>
            </label>
            <span class="small">BACKUP</span>
          </div>

          <div class="page-length-group" style="display: flex; align-items: center; gap: 5px; flex-wrap: wrap;">
            <i class="fas fa-list-ol"></i>
            <select id="pageLengthSelect" class="form-select">
              <option value="10" selected>10 řádků</option>
              <option value="15">15 řádků</option>
              <option value="25">25 řádků</option>
              <option value="50">50 řádků</option>
              <option value="100">100 řádků</option>
            </select>
          </div>

          <button id="btnChart" class="btn btn-primary btn-chart"
            title="Zobrazit graf - aktivní při výběru 1 zařízení + 1 vlastnosti (Alt+G)" disabled>
            <i class="fas fa-chart-line"></i> Graf
          </button>

          <div class="export-wrapper">
            <button id="btnExport" class="btn-icon" title="Export dat"><i class="fas fa-file-export"></i>
              Export</button>
            <div id="exportDropdown" class="export-dropdown">
              <div class="export-dropdown-header">CSV Export</div>
              <div class="export-item" id="exportCSVVisible" tabindex="0">
                <i class="fas fa-file-csv"></i> Zobrazené sloupce
              </div>
              <div class="export-item" id="exportCSVAll" tabindex="0">
                <i class="fas fa-file-csv"></i> Všechny sloupce
              </div>
              <div class="export-dropdown-header" style="margin-top: 10px;">Excel Export</div>
              <div class="export-item" id="exportXLSXVisible" tabindex="0">
                <i class="fas fa-file-excel"></i> Zobrazené sloupce
              </div>
              <div class="export-item" id="exportXLSXAll" tabindex="0">
                <i class="fas fa-file-excel"></i> Všechny sloupce
              </div>

            </div>
          </div>

          <div class="col-vis-wrapper">
            <button id="btnColumnVis" class="btn-icon" title="Zobrazit/skrýt sloupce (Alt+V)"><i
                class="fas fa-columns"></i> Sloupce</button>
            <div id="colVisDropdown" class="col-vis-dropdown">
              <!-- Generated by JS -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="stats-bar" id="statsBar">
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-clock"></i></div>
      <div class="stat-info">
        <span class="stat-value" id="statLastHour">0</span>
        <span class="stat-label">Za poslední hodinu</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-calendar-day"></i></div>
      <div class="stat-info">
        <span class="stat-value" id="statLast24h">0</span>
        <span class="stat-label">Za posledních 24h</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-server"></i></div>
      <div class="stat-info">
        <span class="stat-value" id="statTopDevice">-</span>
        <span class="stat-label">Top Zařízení</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-wave-square"></i></div>
      <div class="stat-info">
        <span class="stat-value" id="statTopFrequency">-</span>
        <span class="stat-label">Top Frekvence</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-tag"></i></div>
      <div class="stat-info">
        <span class="stat-value" id="statTopProperty">-</span>
        <span class="stat-label">Top Vlastnost</span>
      </div>
    </div>
  </div>

  <main>
    <div class="table-wrapper">
      <table id="recordsTable" class="display nowrap" role="grid" aria-label="Auditní záznamy">
        <thead>
          <tr role="row">
            <th scope="col" aria-sort="descending">Id</th>
            <th scope="col">Datum</th>
            <th scope="col">Zařízení</th>
            <th scope="col">Region</th>
            <th scope="col">Lokalita</th>
            <th scope="col">Frekvence</th>
            <th scope="col">Typ</th>
            <th scope="col">Vlastnost</th>
            <th scope="col">Stará hodnota</th>
            <th scope="col">Nová hodnota</th>
            <th scope="col">Stará hod. (REAL)</th>
            <th scope="col">Nová hod. (REAL)</th>
          </tr>
          <tr class="filters" role="row">
            <th><input id="filter-col-0" class="filter-input" placeholder="Id (např. >10, 10-20)" /></th>
            <th><input id="filter-col-1" class="filter-input" placeholder="Filtr Datum" /></th>
            <th><input id="filter-col-2" class="filter-input" placeholder="Filtr Zařízení" /></th>
            <th><input id="filter-col-3" class="filter-input" placeholder="Filtr Region" /></th>
            <th><input id="filter-col-4" class="filter-input" placeholder="Filtr Lokalita" /></th>
            <th><input id="filter-col-5" class="filter-input" placeholder="Filtr Frekvence" /></th>
            <th><input id="filter-col-6" class="filter-input" placeholder="Filtr Typ" /></th>
            <th><input id="filter-col-7" class="filter-input" placeholder="Filtr Vlastnost" /></th>
            <th><input id="filter-col-8" class="filter-input" placeholder="Filtr Stará hod." /></th>
            <th><input id="filter-col-9" class="filter-input" placeholder="Filtr Nová hod." /></th>
            <th><input id="filter-col-10" class="filter-input" placeholder="REAL (např. >10.5, 0-100)" /></th>
            <th><input id="filter-col-11" class="filter-input" placeholder="REAL (např. >10.5, 0-100)" /></th>
          </tr>
        </thead>
      </table>
    </div>
  </main>

  <footer>
    <div class="status-bar">
      <div class="status-left">
        <span id="dbStatus" class="status-item"><i class="fas fa-database"></i> <span id="dbStatusText">Hlavní
            DB</span></span>
        <span class="status-item"><i class="fas fa-clock"></i> <span id="lastUpdate">Nikdy</span></span>
        <span class="status-item" title="Doba načítání dat ze serveru"><i class="fas fa-bolt"></i> <span
            id="loadTime">0ms</span></span>
      </div>
      <div class="status-right">
        <span class="status-item">Záznamů: <span id="rowCount">0</span></span>
        <button id="helpBtn" class="btn-link"><i class="fas fa-question-circle"></i> Nápověda</button>
      </div>
    </div>
    <div class="copyright">
      &copy; <span id="currentYear"></span> ELVAC SOLUTIONS s.r.o. <span class="text-muted small ms-2"> | v<span
          id="appVersion">...</span></span>
    </div>
  </footer>

  <div id="helpModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="modal-content">
      <h2 id="helpTitle">Nápověda a klávesové zkratky</h2>
      <button id="closeHelp" aria-label="Zavřít nápovědu">&times;</button>
      <div class="modal-body">
        <ul>
          <li><kbd>Alt + F1</kbd> – Nápověda</li>
          <li><kbd>Alt + M</kbd> – přepnutí světlého/tmavého režimu</li>
          <li><kbd>Alt + S</kbd> – přepnutí zdroje dat (Hlavní/Záložní)</li>
          <li><kbd>Alt + C</kbd> – zrušení všech filtrů</li>
          <li><kbd>Alt + P</kbd> – přepnutí panelu filtrů (sbalit/rozbalit)</li>
          <li><kbd>Alt + F</kbd> – fokus na výběr filtru</li>
          <li><kbd>Alt + H</kbd> – fokus na vyhledávání</li>
          <li><kbd>Alt + A</kbd> – přepnutí automatické aktualizace</li>
          <li><kbd>Alt + V</kbd> – zobrazit/skrýt sloupce</li>
          <li><kbd>Alt + E</kbd> – export dat</li>
          <li><kbd>Alt + T</kbd> – fokus na tabulku</li>
          <li><kbd>Alt + ←/→</kbd> – předchozí/další stránka</li>
          <li><kbd>Alt + Home/End</kbd> – první/poslední stránka</li>
          <li><kbd>Alt + G</kbd> – zobrazit graf (aktivní při 1 zařízení + 1 vlastnosti)</li>
          <li><kbd>Esc</kbd> – zavření nápovědy</li>
        </ul>
      </div>
    </div>
  </div>

  <div id="changelogModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="changelogTitle">
    <div class="modal-content modal-lg">
      <h2 id="changelogTitle">Historie změn</h2>
      <button id="closeChangelog" aria-label="Zavřít changelog">&times;</button>
      <div class="modal-body">
        <div id="changelogContent" class="changelog-text">Načítání...</div>
      </div>
      <div class="modal-footer-fixed">
        <a href="/api/changelog/download" class="btn-link"
          style="color: var(--accent-color); text-decoration: none; font-size: 0.9em;" download>
          <i class="fas fa-download"></i> Stáhnout Changelog
        </a>
      </div>

    </div>
  </div>

  <!-- Graf Modal -->
  <div id="chartModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="chartModalTitle">
    <div class="modal-content modal-xl">
      <h2 id="chartModalTitle"><i class="fas fa-chart-line"></i> Graf: <span id="chartTitle"></span></h2>
      <button id="closeChart" aria-label="Zavřít graf">&times;</button>
      <div class="chart-toolbar">
        <label for="chartType" style="font-size:0.85rem; color:var(--text-muted);"><i class="fas fa-shapes"></i>
          Typ:</label>
        <select id="chartType" class="form-select" style="width:auto; min-width:140px;">
          <option value="line">Liniový</option>
          <option value="bar">Sloupcový</option>
          <option value="scatter">Bodový (Scatter)</option>
        </select>

        <label for="chartColor" style="font-size:0.85rem; color:var(--text-muted); margin-left: 1rem;"><i
            class="fas fa-palette"></i> Barva:</label>
        <select id="chartColor" class="form-select" style="width:auto; min-width:120px;">
          <option value="blue" selected>Modrá</option>
          <option value="red">Červená</option>
          <option value="green">Zelená</option>
          <option value="yellow">Žlutá</option>
          <option value="purple">Fialová</option>
          <option value="orange">Oranžová</option>
          <option value="cyan">Tyrkysová</option>
        </select>
        <span id="chartPointCount" class="status-item" style="font-size:0.8rem;"></span>
        <div style="margin-left:auto; display:flex; gap:0.5rem;">
          <button id="exportChartPNG" class="btn-icon" title="Uložit jako PNG">
            <i class="fas fa-image"></i> PNG
          </button>
          <button id="exportChartCSV" class="btn-icon" title="Exportovat data jako CSV">
            <i class="fas fa-file-csv"></i> CSV
          </button>
          <button id="exportChartExcel" class="btn-icon" title="Exportovat data do Excelu">
            <i class="fas fa-file-excel"></i> Excel
          </button>
        </div>
      </div>
      <div class="modal-body chart-body">
        <div id="chartLoading" style="text-align:center; padding:3rem; display:none; color:var(--text-muted);">
          <i class="fas fa-spinner fa-spin fa-2x"></i><br><br>Načítám data...
        </div>
        <canvas id="chartCanvas"></canvas>
      </div>
    </div>
  </div>

  <script src="vendors/jquery/jquery.min.js"></script>
  <script src="vendors/datatables/datatables.min.js"></script>
  <script src="vendors/mark/mark.min.js"></script>
  <script src="vendors/mark/jquery.mark.min.js"></script>
  <script src="vendors/chartjs/chart.min.js"></script>
  <script src="app.js"></script>
</body>

</html>